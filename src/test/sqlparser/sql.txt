DECLARE

@barcode VARCHAR(50),

@workorderid VARCHAR(50),

@barcode1 VARCHAR(50),

@firststring VARCHAR(50),

@stringlength INT





SET @barcode = 'F-F-117T0X-1'

SET @workorderid = '38B65541-74A3-42B6-BCD3-4518B5018A38'

SET @stringlength = LEN(@barcode)

SET @firststring = SUBSTRING(@barcode,1,1)

SET @barcode1 = SUBSTRING(@barcode,3,@stringlength)



IF(@firststring = 'B')

BEGIN

UPDATE MES_WORKORDERSINGLECODE

SET 

PRODUCTSTATUS = 2,

ACTUALBEGINTIME = GETDATE()

WHERE ID = (SELECT ID FROM MES_WORKORDERSINGLECODE WHERE WORKSERIALSINGLECODEID = (SELECT ID FROM MES_SINGLECODE WHERE BARCODE = @barcode1) )



UPDATE MES_SINGLECODE 

SET STATUS = 2

WHERE BARCODE = @barcode1

END



ELSE IF(@firststring = 'F')

BEGIN



 UPDATE MES_WORKORDERSINGLECODE

SET 

PRODUCTSTATUS = 4,

ACTUALFINISHTIME = GETDATE()



WHERE ID = (SELECT ID FROM MES_WORKORDERSINGLECODE WHERE WORKSERIALSINGLECODEID = (SELECT ID FROM MES_SINGLECODE WHERE BARCODE = @barcode1) )



UPDATE MES_SINGLECODE 

SET STATUS = 4

WHERE BARCODE = @barcode1

BEGIN

DECLARE 

 @ACTUALBEGINTIME DATE,

 @ACTUALFINISHTIME DATE

 SELECT @ACTUALBEGINTIME =  ACTUALBEGINTIME FROM MES_WORKORDERSINGLECODE 

 WHERE WORKSERIALSINGLECODEID = (SELECT ID FROM MES_SINGLECODE WHERE BARCODE = @barcode1)

 SELECT @ACTUALFINISHTIME =  ACTUALFINISHTIME FROM MES_WORKORDERSINGLECODE 

 WHERE WORKSERIALSINGLECODEID = (SELECT ID FROM MES_SINGLECODE WHERE BARCODE = @barcode1)

 UPDATE MES_WORKORDERSINGLECODE

 SET 

 WORKTIME = (select (datediff( Minute, '2019-02-27 17:42:29', '2019-03-01 17:39:55' )/60.0))

WHERE ID = (SELECT ID FROM MES_WORKORDERSINGLECODE WHERE WORKSERIALSINGLECODEID = (SELECT ID FROM MES_SINGLECODE WHERE BARCODE = @barcode1) )

select WORKTIME from MES_WORKORDERSINGLECODE WHERE ID = (SELECT ID FROM MES_WORKORDERSINGLECODE WHERE WORKSERIALSINGLECODEID = (SELECT ID FROM MES_SINGLECODE WHERE BARCODE = @barcode1) )

END

 

END